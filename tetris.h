#ifndef _TETRIS_H_
#define _TETRIS_H_


#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <ncurses.h>
#include <signal.h>
#include <string.h>

#define WIDTH	10
#define HEIGHT	22
#define NOTHING	0
#define QUIT	'q'
#define NUM_OF_SHAPE	7
#define NUM_OF_ROTATE	4
#define BLOCK_HEIGHT	4
#define BLOCK_WIDTH	4
#define BLOCK_NUM	3

// menu number
#define MENU_PLAY '1'
#define MENU_RANK '2'
#define MENU_RECOMMEND '3'
#define MENU_EXIT '4'

// ì‚¬ìš©ì ì´ë¦„ì˜ ê¸¸ì´
#define NAMELEN 16
#define CHILDREN_MAX 36

typedef struct _Node{
    char name[NAMELEN];
    int score;
    struct _Node* link;
}Node;

typedef struct _RecNode{
	int score;
    int lv;
	char recField[HEIGHT][WIDTH];
	struct _RecNode *child[CHILDREN_MAX];
    int curBlockID;
    int recBlockX, recBlockY, recBlockRotate;
    struct _RecNode* parent;
} RecNode;

typedef struct {
    int x;
    int y;
    int r;
}mod_rec;

/* [blockShapeID][# of rotate][][]*/
const char block[NUM_OF_SHAPE][NUM_OF_ROTATE][BLOCK_HEIGHT][BLOCK_WIDTH] ={
	{/*[0][][][]					â–©â–©â–©â–©*/
		{/*[][0][][]*/
			{0, 0, 0, 0}, {1, 1, 1, 1}, {0, 0, 0, 0}, {0, 0, 0, 0}
		},
		{/*[][1][][]*/
			{0, 1, 0, 0}, {0, 1, 0, 0}, {0, 1, 0, 0}, {0, 1, 0, 0}			
		},
		{/*[][2][][]*/
			{0, 0, 0, 0}, {1, 1, 1, 1}, {0, 0, 0, 0}, {0, 0, 0, 0}			
		},
		{/*[][3][][]*/
			{0, 1, 0, 0}, {0, 1, 0, 0}, {0, 1, 0, 0}, {0, 1, 0, 0}
		}
	},
	{/*[1][][][];					  â–©â–©â–©*/
		{/*[][0][][]				      â–©*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 1}, {0, 0, 0, 1}
		},
		{/*[][1][][]*/
			{0, 0, 0, 0}, {0, 0 ,1, 1}, {0, 0, 1, 0}, {0, 0, 1, 0}
		},
		{/*[][2][][]*/
			{0, 0, 0, 0}, {0, 1, 0, 0}, {0, 1, 1, 1}, {0, 0, 0, 0}
		},
		{/*[][3][][]*/
			{0, 0, 0, 0}, {0, 0, 1, 0}, {0, 0, 1, 0}, {0, 1, 1, 0}
		}
	},
	{/*[2][][][];					  â–©â–©â–©*/
		{/*[][0][][]				  â–©*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 1}, {0, 1, 0, 0}
		},
		{/*[][1][][]*/
			{0, 0, 0, 0}, {0, 0, 1, 0}, {0, 0, 1, 0}, {0, 0, 1, 1}
		},
		{/*[][2][][]*/
			{0, 0, 0, 0}, {0, 0, 0, 1}, {0, 1, 1, 1}, {0, 0, 0, 0}
		},
		{/*[][3][][]*/
			{0, 0, 0, 0}, {0, 1, 1, 0}, {0, 0, 1, 0}, {0, 0, 1, 0}
		}
	},
	{/*[3][][][];					  â–©â–©â–©*/
		{/*[][0][][]				    â–©*/
			{0, 0, 0, 0}, {0, 1, 0, 0}, {1, 1, 1, 0}, {0, 0, 0, 0}
		},
		{/*[][1][][]*/
			{0, 0, 0, 0}, {0, 1, 0, 0}, {1, 1, 0, 0}, {0, 1, 0, 0}
		},
		{/*[][2][][]*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {1, 1, 1, 0}, {0, 1, 0, 0}
		},
		{/*[][3][][]*/
			{0, 0, 0, 0}, {0, 1, 0, 0}, {0, 1, 1, 0}, {0, 1, 0, 0}
		}
	},
	{/*[4][][][];					  â–©â–©*/
		{/*[][0][][]				  â–©â–©*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 0}, {0, 1, 1, 0}
		},
		{/*[][1][][]*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 0}, {0, 1, 1, 0}
		},
		{/*[][2][][]*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 0}, {0, 1, 1, 0}
		},
		{/*[][3][][]*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 0}, {0, 1, 1, 0}
		}
	},
	{/*[5][][][];					  â–©â–©*/
		{/*[][0][][]				â–©â–©*/
			{0, 0, 0, 0}, {0, 0, 1, 1}, {0, 1, 1, 0}, {0, 0, 0, 0}
		},
		{/*[][1][][]*/
			{0, 0, 0, 0}, {0, 1, 0, 0}, {0, 1, 1, 0}, {0, 0, 1, 0}			
		},
		{/*[][2][][]*/
			{0, 0, 0, 0}, {0, 0, 1, 1}, {0, 1, 1, 0}, {0, 0, 0, 0}			
		},
		{/*[][3][][]*/
			{0, 0, 0, 0}, {0, 1, 0, 0}, {0, 1, 1, 0}, {0, 0, 1, 0}			
		}
	},
	{/*[6][][][];					â–©â–©*/
		{/*[][0][][]				  â–©â–©*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 0}, {0, 0, 1, 1}
		},
		{/*[][1][][]*/
			{0, 0, 0, 0}, {0, 0, 1, 0}, {0, 1, 1, 0}, {0, 1, 0, 0}
		},
		{/*[][2][][]*/
			{0, 0, 0, 0}, {0, 0, 0, 0}, {0, 1, 1, 0}, {0, 0, 1, 1}
		},
		{/*[][3][][]*/
			{0, 0, 0, 0}, {0, 0, 1, 0}, {0, 1, 1, 0}, {0, 1, 0, 0}
		}
	}
};

char field[HEIGHT][WIDTH];	/* í…ŒíŠ¸ë¦¬ìŠ¤ì˜ ë©”ì¸ ê²Œì„ í™”ë©´ */
int nextBlock[BLOCK_NUM];	/* í˜„ì¬ ë¸”ëŸ­ì˜ IDì™€ ë‹¤ìŒ ë¸”ëŸ­ì˜ IDë“¤ì„ ì €ì¥; [0]: í˜„ì¬ ë¸”ëŸ­; [1]: ë‹¤ìŒ ë¸”ëŸ­ */
int blockRotate,blockY,blockX;	/* í˜„ì¬ ë¸”ëŸ­ì˜ íšŒì „, ë¸”ëŸ­ì˜ Y ì¢Œí‘œ, ë¸”ëŸ­ì˜ X ì¢Œí‘œ*/
int score;			/* ì ìˆ˜ê°€ ì €ì¥*/
int gameOver=0;			/* ê²Œì„ì´ ì¢…ë£Œë˜ë©´ 1ë¡œ settingëœë‹¤.*/
int timed_out;
int recommendR,recommendY,recommendX; // ì¶”ì²œ ë¸”ëŸ­ ë°°ì¹˜ ì •ë³´. ì°¨ë¡€ëŒ€ë¡œ íšŒì „, Y ì¢Œí‘œ, X ì¢Œí‘œ
Node* head;
RecNode *recRoot;

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ì˜ ëª¨ë“   global ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™” í•´ì¤€ë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void InitTetris();

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ì˜ ëª¨ë“   interfaceë¥¼ ê·¸ë ¤ì¤€ë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void DrawOutline();

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ì™€ ê´€ë ¨ëœ í‚¤ì…ë ¥ì„ ë°›ëŠ”ë‹¤.
 *	input	: none
 *	return	: (int) ì…ë ¥ë°›ì€ command
 *		  KEY_DOWN : ë°©í–¥í‚¤ ì•„ë˜
 *		  KEY_UP   : ë°©í–¥í‚¤ ìœ„
 *		  KEY_RIGHT: ë°©í–¥í‚¤ ì˜¤ë¥¸ìª½
 *		  KEY_LEFT : ë°©í–¥í‚¤ ì™¼ìª½
 *		  ' '	   : Space bar
 *		  'q'/'Q'  : quit
 ***********************************************************/
int GetCommand();

/***********************************************************
 *	GetCommandë¡œ ì…ë ¥ë°›ì€ commandì— ëŒ€í•œ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤.
 *	input	: (int) GetCommandë¡œ ë°›ì€ command
 *	return	: (int) quitì— ëŒ€í•œ ì…ë ¥ì„ ë°›ì„ ê²½ìš° 0,
 * 		  ê·¸ì™¸ì˜ ê²½ìš° 1ì„ returní•œë‹¤.
 ***********************************************************/
int ProcessCommand(int command);

/***********************************************************
 *	ë¸”ëŸ­ì´ ì¼ì • ì‹œê°„(1ì´ˆ)ë§ˆë‹¤ ë‚´ë ¤ê°€ë„ë¡ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
 *	ë”ì´ìƒ ë‚´ë¦´ìˆ˜ ì—†ì„ ê²½ìš°,
 *		ë¸”ëŸ­ì„ fieldì— í•©ì¹œë‹¤.
 *		ì™„ì „ì´ ì±„ì›Œì§„ lineì„ ì§€ìš´ë‹¤.
 *		next blockì„ current blockìœ¼ë¡œ ë°”ê¿”ì£¼ê³ 
 *		blockì˜ ì¢Œí‘œë¥¼ ì´ˆê¸°í™” í•œë‹¤.
 *		ë‹¤ìŒ ë¸”ëŸ­ì„ í™”ë©´ì— ê·¸ë¦¬ê³  ê°±ì‹ ëœ scoreë¥¼ 
 *		í™”ë©´ì— displayí•œë‹¤.
 *	input	: (int) sig
 *	return	: none
 ***********************************************************/
void BlockDown(int sig);

/***********************************************************
 *	ì…ë ¥ëœ ì›€ì§ì„ì´ ê°€ëŠ¥í•œì§€ë¥¼ íŒë‹¨í•´ì£¼ëŠ” í•¨ìˆ˜.
 *	input	: (char[][]) ë¸”ëŸ­ì˜ ì›€ì§ì„ì„ í™•ì¸í•  í•„ë“œ
 *		  (int) í˜„ì¬ ë¸”ëŸ­ì˜ ëª¨ì–‘ ID
 *		  (int) ë¸”ëŸ­ì˜ íšŒì „ íšŸìˆ˜
 *		  (int) ë¸”ëŸ­ì˜ Yì¢Œí‘œ
 *		  (int) ë¸”ëŸ­ì˜ Xì¢Œí‘œ
 *	return	: (int) ì…ë ¥ì— ëŒ€í•œ ë¸”ëŸ­ ì›€ì§ì„ì´ ê°€ëŠ¥í•˜ë©´ 1
 *		  ê°€ëŠ¥í•˜ì§€ ì•Šìœ¼ë©´ 0ì„ return í•œë‹¤.
 ***********************************************************/
int CheckToMove(char f[HEIGHT][WIDTH],int currentBlock,int blockRotate, int blockY, int blockX);

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ì—ì„œ commandì— ì˜í•´ ë°”ë€ ë¶€ë¶„ë§Œ ë‹¤ì‹œ ê·¸ë ¤ì¤€ë‹¤.
 *	input	: (char[][]) commandì˜í•´ ë°”ë€ ë¸”ëŸ­ì„ í™•ì¸í•  í•„ë“œ
 *		  (int) ë°”ë€Œê¸° ì „ ëª¨ì–‘ì„ ì•Œê¸° ìœ„í•´ commandë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ëŠ”ë‹¤.
 *		  (int) í˜„ì¬ ë¸”ëŸ­ì˜ ëª¨ì–‘ ID
 *		  (int) ë¸”ëŸ­ì˜ íšŒì „ íšŸìˆ˜
 *		  (int) ë¸”ëŸ­ì˜ Yì¢Œí‘œ
 *		  (int) ë¸”ëŸ­ì˜ Xì¢Œí‘œ
 *	return	: none
 ***********************************************************/
void DrawChange(char f[HEIGHT][WIDTH],int command,int currentBlock,int blockRotate, int blockY, int blockX);

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ì˜ ë¸”ëŸ­ì´ ìŒ“ì´ëŠ” fieldë¥¼ ê·¸ë ¤ì¤€ë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void DrawField();

/***********************************************************
 *	ë–¨ì–´ì§€ëŠ” ë¸”ëŸ­ì„ fieldì— ë”í•´ì¤€ë‹¤.
 *	input	: (char[][]) ë¸”ëŸ­ì„ ìŒ“ì„ í•„ë“œ
 *		  (int) í˜„ì¬ ë¸”ëŸ­ì˜ ëª¨ì–‘ ID
 *		  (int) ë¸”ëŸ­ì˜ íšŒì „ íšŸìˆ˜
 *		  (int) ë¸”ëŸ­ì˜ Yì¢Œí‘œ
 *		  (int) ë¸”ëŸ­ì˜ Xì¢Œí‘œ
 *	return	: 1ì£¼ì°¨ ì‹¤ìŠµì—ì„œëŠ” 0ì„ ë¦¬í„´í•˜ì§€ë§Œ, 1ì£¼ì°¨ ìˆ™ì œ êµ¬í˜„ì‹œ scoreë¥¼ ê³„ì‚°í•˜ì—¬ ë¦¬í„´í•œë‹¤.
 ***********************************************************/
int AddBlockToField(char f[HEIGHT][WIDTH],int currentBlock,int blockRotate, int blockY, int blockX);

/***********************************************************
 *	ì™„ì „íˆ ì±„ì›Œì§„ Lineì„ ì‚­ì œí•˜ê³  ì ìˆ˜ë¥¼ ë§¤ê²¨ì¤€ë‹¤.
 *	input	: (char[][]) ì™„ì „íˆ ì±„ì›Œì§„ lineì„ í™•ì¸í•  í•„ë“œ
 *	return	: (int) ì‚­ì œëœ ë¼ì¸ì˜ ê°¯ìˆ˜ì— ëŒ€í•œ ì ìˆ˜
 ***********************************************************/
int DeleteLine(char f[HEIGHT][WIDTH]);

/***********************************************************
 *	ì»¤ì„œì˜ ìœ„ì¹˜ë¥¼ ì…ë ¥ëœ x, yì˜ ìœ„ì¹˜ë¡œ ì˜®ê²¨ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.
 *	input	: (int) ì»¤ì„œì˜ ì´ë™í•  y ì¢Œí‘œ
 *		  (int) ì»¤ì„œì˜ ì´ë™í•  x ì¢Œí‘œ
 *	return	: none
 ***********************************************************/
void gotoyx(int y, int x);

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ì˜ í™”ë©´ ì˜¤ë¥¸ìª½ìƒë‹¨ì— ë‹¤ìŒ ë‚˜ì˜¬ ë¸”ëŸ­ì„ ê·¸ë ¤ì¤€ë‹¤..
 *	input	: (int*) ë¸”ëŸ­ì˜ ëª¨ì–‘ì— ëŒ€í•œ ID ë°°ì—´
 *	return	: none
 ***********************************************************/
void DrawNextBlock(int *nextBlock);

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ì˜ í™”ë©´ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— Scoreë¥¼ ì¶œë ¥í•œë‹¤.
 *	input	: (int) ì¶œë ¥í•  ì ìˆ˜
 *	return	: none
 ***********************************************************/
void PrintScore(int score);

/***********************************************************
 *	í•´ë‹¹ ì¢Œí‘œ(y,x)ì— ì›í•˜ëŠ” í¬ê¸°(height,width)ì˜ boxë¥¼ ê·¸ë¦°ë‹¤.
 *	input	: (int) ê·¸ë¦¬ê³ ì í•˜ëŠ” ë°•ìŠ¤ì˜ ì™¼ìª½ ìƒë‹¨ëª¨ì„œë¦¬ì˜ y ì¢Œí‘œ
 *		  (int) ì™¼ìª½ ìƒë‹¨ ëª¨ì„œë¦¬ì˜ x ì¢Œí‘œ
 *		  (int) ë°•ìŠ¤ì˜ ë†’ì´
 *		  (int) ë°•ìŠ¤ì˜ ë„“ì´
 *	return	: none
 ***********************************************************/
void DrawBox(int y,int x, int height, int width);

/***********************************************************
 *	í•´ë‹¹ ì¢Œí‘œ(y,x)ì— ì›í•˜ëŠ” ëª¨ì–‘ì˜ ë¸”ë¡ì„ ê·¸ë¦°ë‹¤.
 *	input	: (int) ê·¸ë¦¬ê³ ì í•˜ëŠ” ë°•ìŠ¤ì˜ ì™¼ìª½ ìƒë‹¨ëª¨ì„œë¦¬ì˜ y ì¢Œí‘œ
 *		  (int) ì™¼ìª½ ìƒë‹¨ ëª¨ì„œë¦¬ì˜ x ì¢Œí‘œ
 *		  (int) ë¸”ë¡ì˜ ëª¨ì–‘
 *		  (int) ë¸”ë¡ì˜ íšŒì „ íšŸìˆ˜
 *		  (char) ë¸”ë¡ì„ ê·¸ë¦´ íŒ¨í„´ ëª¨ì–‘
 *	return	: none
 ***********************************************************/
void DrawBlock(int y, int x, int blockID,int blockRotate,char tile);

/***********************************************************
 *	ë¸”ë¡ì´ ë–¨ì–´ì§ˆ ìœ„ì¹˜ë¥¼ ë¯¸ë¦¬ ë³´ì—¬ì¤€ë‹¤.
 *	input	: (int) ê·¸ë¦¼ìë¥¼ ë³´ì—¬ì¤„ ë¸”ë¡ì˜ ì™¼ìª½ ìƒë‹¨ëª¨ì„œë¦¬ì˜ y ì¢Œí‘œ
 *		  (int) ì™¼ìª½ ìƒë‹¨ ëª¨ì„œë¦¬ì˜ x ì¢Œí‘œ
 *		  (int) ë¸”ë¡ì˜ ëª¨ì–‘
 *		  (int) ë¸”ë¡ì˜ íšŒì „ íšŸìˆ˜
 *	return	: none
 ***********************************************************/
void DrawShadow(int y, int x, int blockID,int blockRotate);

/***********************************************************
 *	í…ŒíŠ¸ë¦¬ìŠ¤ ê²Œì„ì„ ì‹œì‘í•œë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void play();

/***********************************************************
 *	ë©”ë‰´ë¥¼ ë³´ì—¬ì¤€ë‹¤.
 *	input	: none
 *	return	: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ë‰´ ë²ˆí˜¸
 ***********************************************************/
char menu();

/***********************************************************
 *	rank fileë¡œë¶€í„° ë­í‚¹ ì •ë³´ë¥¼ ì½ì–´ì™€ ë­í‚¹ ëª©ë¡ì„ êµ¬ì„±í•œë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void createRankList();

/***********************************************************
 *	í™”ë©´ì— ë­í‚¹ ê¸°ë¡ë“¤ì„ ë³´ì—¬ì¤€ë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void rank();

/***********************************************************
 *	rank fileì„ ìƒì„±í•œë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void writeRankFile();

/***********************************************************
 *	ìƒˆë¡œìš´ ë­í‚¹ ì •ë³´ë¥¼ ì¶”ê°€í•œë‹¤.
 *	input	: (int) ìƒˆë¡œìš´ ë­í‚¹ì˜ ì ìˆ˜
 *	return	: none
 ***********************************************************/
void newRank(int score);

/***********************************************************
 *	ì¶”ì²œ ë¸”ëŸ­ ë°°ì¹˜ë¥¼ êµ¬í•œë‹¤.
 *	input	: (RecNode*) ì¶”ì²œ íŠ¸ë¦¬ì˜ ë£¨íŠ¸
 *	return	: (int) ì¶”ì²œ ë¸”ëŸ­ ë°°ì¹˜ë¥¼ ë”°ë¥¼ ë•Œ ì–»ì–´ì§€ëŠ” ì˜ˆìƒ ìŠ¤ì½”ì–´
 ***********************************************************/
int recommend(RecNode *root);

/***********************************************************
 *	ì¶”ì²œ ê¸°ëŠ¥ì— ë”°)¼ ë¸”ëŸ­ì„ ë°°ì¹˜í•˜ì—¬ ì§„í–‰í•˜ëŠ” ê²Œì„ì„ ì‹œì‘í•œë‹¤.
 *	input	: none
 *	return	: none
 ***********************************************************/
void recommendedPlay();

void DrawBlockWithFeatures();

void rmenu_one();

void rmenu_two();
 
void rmenu_three();

void create_tree(RecNode*);

void free_tree(RecNode*);

void modified_recommend(RecNode*);

void recBlockDown(int sig);

void recInitTetris();

#endif
